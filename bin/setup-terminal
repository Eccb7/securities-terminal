#!/bin/bash
# Setup script for Kenya Securities Terminal

set -e

echo "ğŸš€ Setting up Kenya Securities Terminal..."

# Check Ruby version
echo "âœ“ Checking Ruby version..."
ruby -v

# Check if bundler is installed
if ! command -v bundle &> /dev/null; then
    echo "ğŸ“¦ Installing Bundler..."
    gem install bundler
fi

# Install dependencies
echo "ğŸ“¦ Installing Ruby gems..."
bundle install

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js is not installed. Please install Node.js 18+ first."
    exit 1
fi

# Install Node dependencies
echo "ğŸ“¦ Installing Node.js packages..."
npm install

# Setup environment file
if [ ! -f .env ]; then
    echo "ğŸ“ Creating .env file from template..."
    cp .env.example .env
    echo "âš ï¸  Please edit .env file with your configuration"
fi

# Create database
echo "ğŸ—„ï¸  Creating database..."
bundle exec rails db:create

# Run migrations
echo "ğŸ”„ Running migrations..."
bundle exec rails db:migrate

# Seed database
echo "ğŸŒ± Seeding database..."
bundle exec rails db:seed

# Setup test database
echo "ğŸ§ª Setting up test database..."
RAILS_ENV=test bundle exec rails db:create db:migrate

echo "âœ… Setup complete!"
echo ""
echo "To start the application:"
echo "  bin/dev"
echo ""
echo "To run tests:"
echo "  bundle exec rspec"
echo ""
echo "To access the application:"
echo "  http://localhost:3000"
