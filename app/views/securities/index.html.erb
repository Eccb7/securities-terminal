<div class="space-y-6">
  <!-- Page header -->
  <div class="border-b border-gray-200 pb-5">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold leading-6 text-gray-900">Securities</h1>
        <p class="mt-2 text-sm text-gray-500">
          Browse and search tradable securities on the NSE
        </p>
      </div>
      
      <!-- Search and filters -->
      <div class="flex gap-4">
        <%= form_with url: securities_path, method: :get, class: "flex gap-2" do |f| %>
          <%= f.text_field :q, value: params[:q], placeholder: "Search ticker or name...", class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          
          <%= f.select :instrument_type, 
                       options_for_select([["All Types", ""], ["Equity", "equity"], ["Bond", "bond"], ["ETF", "etf"]], params[:instrument_type]),
                       {}, 
                       class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          
          <%= f.select :exchange_id,
                       options_from_collection_for_select(@exchanges, :id, :name, params[:exchange_id]),
                       { include_blank: "All Exchanges" },
                       class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          
          <%= f.submit "Filter", class: "inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500" %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Securities table -->
  <div class="overflow-hidden rounded-lg bg-white shadow">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Ticker</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Name</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Type</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Last Price</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Change</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Volume</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <% @securities.each do |security| %>
          <% latest_quote = security.latest_quote %>
          <tr data-controller="market-data" data-market-data-security-id-value="<%= security.id %>" class="hover:bg-gray-50">
            <td class="whitespace-nowrap px-6 py-4">
              <div class="text-sm font-medium text-gray-900"><%= security.ticker %></div>
            </td>
            <td class="px-6 py-4">
              <div class="text-sm text-gray-900"><%= security.name %></div>
              <div class="text-xs text-gray-500"><%= security.exchange.code %></div>
            </td>
            <td class="whitespace-nowrap px-6 py-4">
              <span class="inline-flex rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-800">
                <%= security.instrument_type.titleize %>
              </span>
            </td>
            <td class="whitespace-nowrap px-6 py-4 text-right">
              <div class="text-sm font-medium text-gray-900" data-market-data-target="price">
                <%= latest_quote ? number_to_currency(latest_quote.last_price, unit: "KES ") : "—" %>
              </div>
            </td>
            <td class="whitespace-nowrap px-6 py-4 text-right">
              <% if latest_quote&.price_change %>
                <div class="text-sm font-medium <%= latest_quote.price_change >= 0 ? 'text-green-600' : 'text-red-600' %>" data-market-data-target="change">
                  <%= latest_quote.price_change >= 0 ? '+' : '' %><%= number_with_precision(latest_quote.price_change, precision: 2) %>
                  (<%= number_to_percentage(latest_quote.price_change_percentage, precision: 2) %>)
                </div>
              <% else %>
                <div class="text-sm text-gray-500">—</div>
              <% end %>
            </td>
            <td class="whitespace-nowrap px-6 py-4 text-right">
              <div class="text-sm text-gray-900" data-market-data-target="volume">
                <%= latest_quote ? number_with_delimiter(latest_quote.volume) : "—" %>
              </div>
            </td>
            <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
              <%= link_to "View", security_path(security), class: "text-blue-600 hover:text-blue-900 mr-3" %>
              <% if current_user.can_trade? %>
                <%= link_to "Trade", new_order_path(security_id: security.id), class: "text-green-600 hover:text-green-900" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center">
    <%= paginate @securities %>
  </div>
</div>
