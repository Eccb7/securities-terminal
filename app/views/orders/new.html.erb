<div class="space-y-6">
  <!-- Page header -->
  <div class="border-b border-gray-200 pb-5">
    <h1 class="text-3xl font-bold leading-6 text-gray-900">New Order</h1>
    <p class="mt-2 text-sm text-gray-500">
      Place a new order to buy or sell securities
    </p>
  </div>

  <%= form_with model: @order, class: "space-y-6" do |f| %>
    <% if @order.errors.any? %>
      <div class="rounded-md bg-red-50 p-4">
        <h3 class="text-sm font-medium text-red-800">
          <%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:
        </h3>
        <ul class="mt-2 list-disc list-inside text-sm text-red-700">
          <% @order.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
      <!-- Left column - Order Details -->
      <div class="space-y-6">
        <div class="overflow-hidden rounded-lg bg-white shadow">
          <div class="px-4 py-5 sm:p-6 space-y-6">
            <h3 class="text-lg font-medium leading-6 text-gray-900">Order Details</h3>

            <!-- Security Selection -->
            <div>
              <%= f.label :security_id, "Security", class: "block text-sm font-medium text-gray-700" %>
              <%= f.collection_select :security_id, 
                                     @securities, 
                                     :id, 
                                     :display_name,
                                     { include_blank: "Select a security" },
                                     { class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
                                       data: { controller: "order-form", action: "change->order-form#securityChanged" } } %>
            </div>

            <!-- Side (Buy/Sell) -->
            <div>
              <%= f.label :side, class: "block text-sm font-medium text-gray-700" %>
              <div class="mt-2 grid grid-cols-2 gap-3">
                <label class="relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none">
                  <%= f.radio_button :side, "buy", class: "sr-only", checked: params[:side] == "buy" %>
                  <span class="flex flex-1">
                    <span class="flex flex-col">
                      <span class="block text-sm font-medium text-gray-900">Buy</span>
                      <span class="mt-1 flex items-center text-sm text-gray-500">Long position</span>
                    </span>
                  </span>
                  <svg class="h-5 w-5 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                </label>

                <label class="relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none">
                  <%= f.radio_button :side, "sell", class: "sr-only", checked: params[:side] == "sell" %>
                  <span class="flex flex-1">
                    <span class="flex flex-col">
                      <span class="block text-sm font-medium text-gray-900">Sell</span>
                      <span class="mt-1 flex items-center text-sm text-gray-500">Short position</span>
                    </span>
                  </span>
                  <svg class="h-5 w-5 text-red-600" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                </label>
              </div>
            </div>

            <!-- Order Type -->
            <div>
              <%= f.label :order_type, class: "block text-sm font-medium text-gray-700" %>
              <%= f.select :order_type,
                          [["Market Order", "market"], ["Limit Order", "limit"], ["Stop Order", "stop"], ["Stop Limit", "stop_limit"]],
                          {},
                          { class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
                            data: { action: "change->order-form#orderTypeChanged" } } %>
            </div>

            <!-- Quantity -->
            <div>
              <%= f.label :quantity, class: "block text-sm font-medium text-gray-700" %>
              <%= f.number_field :quantity, 
                                step: 100,
                                min: 100,
                                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
                                placeholder: "Enter quantity (multiples of 100)" %>
              <p class="mt-1 text-sm text-gray-500">Must be a multiple of the lot size (100 shares)</p>
            </div>

            <!-- Price (for limit orders) -->
            <div data-order-form-target="priceField" class="hidden">
              <%= f.label :price, class: "block text-sm font-medium text-gray-700" %>
              <%= f.number_field :price,
                                step: 0.01,
                                min: 0,
                                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
                                placeholder: "Enter limit price" %>
              <p class="mt-1 text-sm text-gray-500">Price per share in KES</p>
            </div>

            <!-- Stop Price (for stop orders) -->
            <div data-order-form-target="stopPriceField" class="hidden">
              <%= f.label :stop_price, class: "block text-sm font-medium text-gray-700" %>
              <%= f.number_field :stop_price,
                                step: 0.01,
                                min: 0,
                                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",
                                placeholder: "Enter stop price" %>
              <p class="mt-1 text-sm text-gray-500">Trigger price in KES</p>
            </div>

            <!-- Time in Force -->
            <div>
              <%= f.label :time_in_force, "Time in Force", class: "block text-sm font-medium text-gray-700" %>
              <%= f.select :time_in_force,
                          [["Day", "day"], ["Good Till Cancelled (GTC)", "gtc"], ["Immediate or Cancel (IOC)", "ioc"], ["Fill or Kill (FOK)", "fok"]],
                          {},
                          { class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" } %>
            </div>
          </div>
        </div>
      </div>

      <!-- Right column - Order Summary & Market Data -->
      <div class="space-y-6">
        <!-- Market Data -->
        <div class="overflow-hidden rounded-lg bg-white shadow" data-controller="market-data" data-market-data-security-id-value="<%= @order.security_id %>">
          <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">Market Data</h3>
            
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Last Price:</span>
                <span class="text-sm font-medium text-gray-900" data-market-data-target="price">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Bid:</span>
                <span class="text-sm font-medium text-green-600">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Ask:</span>
                <span class="text-sm font-medium text-red-600">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Change:</span>
                <span class="text-sm font-medium" data-market-data-target="change">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Volume:</span>
                <span class="text-sm font-medium text-gray-900" data-market-data-target="volume">—</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="overflow-hidden rounded-lg bg-blue-50 shadow">
          <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg font-medium leading-6 text-blue-900 mb-4">Order Summary</h3>
            
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-sm text-blue-700">Estimated Value:</span>
                <span class="text-sm font-medium text-blue-900" data-order-form-target="estimatedValue">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-blue-700">Commission (0.5%):</span>
                <span class="text-sm font-medium text-blue-900">—</span>
              </div>
              <div class="flex justify-between border-t border-blue-200 pt-3">
                <span class="text-base font-medium text-blue-900">Total:</span>
                <span class="text-base font-bold text-blue-900">—</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex gap-3">
          <%= f.submit "Place Order", class: "flex-1 inline-flex justify-center items-center rounded-md bg-blue-600 px-4 py-3 text-base font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600" %>
          <%= link_to "Cancel", orders_path, class: "flex-1 inline-flex justify-center items-center rounded-md bg-white px-4 py-3 text-base font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50" %>
        </div>
      </div>
    </div>
  <% end %>
</div>
