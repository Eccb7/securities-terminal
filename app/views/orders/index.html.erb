<div class="space-y-6">
  <!-- Page header -->
  <div class="border-b border-gray-200 pb-5">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold leading-6 text-gray-900">Orders</h1>
        <p class="mt-2 text-sm text-gray-500">
          View and manage your trading orders
        </p>
      </div>
      
      <% if current_user.can_trade? %>
        <%= link_to "New Order", new_order_path, class: "inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500" %>
      <% end %>
    </div>
  </div>

  <!-- Filters -->
  <div class="flex gap-4">
    <%= form_with url: orders_path, method: :get, class: "flex gap-2 flex-wrap" do |f| %>
      <%= f.select :status,
                  options_for_select([["All", ""], ["Pending", "pending"], ["Open", "open"], ["Partially Filled", "partially_filled"], ["Filled", "filled"], ["Cancelled", "cancelled"], ["Rejected", "rejected"]], params[:status]),
                  {},
                  class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      
      <%= f.select :side,
                  options_for_select([["All Sides", ""], ["Buy", "buy"], ["Sell", "sell"]], params[:side]),
                  {},
                  class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      
      <%= f.submit "Filter", class: "inline-flex items-center rounded-md bg-gray-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500" %>
      
      <% if params[:status].present? || params[:side].present? %>
        <%= link_to "Clear", orders_path, class: "inline-flex items-center rounded-md bg-white px-4 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50" %>
      <% end %>
    <% end %>
  </div>

  <!-- Orders table -->
  <div class="overflow-hidden rounded-lg bg-white shadow">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Order ID</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Security</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Side</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Type</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Quantity</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Price</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Filled</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Status</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Created</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <% if @orders.any? %>
          <% @orders.each do |order| %>
            <tr class="hover:bg-gray-50">
              <td class="whitespace-nowrap px-6 py-4">
                <div class="text-sm font-medium text-gray-900">#<%= order.id %></div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <div class="text-sm font-medium text-gray-900"><%= order.security.ticker %></div>
                <div class="text-xs text-gray-500"><%= order.security.name %></div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <span class="inline-flex rounded-full px-2 py-1 text-xs font-semibold <%= order.buy? ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                  <%= order.side.titleize %>
                </span>
              </td>
              <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900">
                <%= order.order_type.titleize %>
              </td>
              <td class="whitespace-nowrap px-6 py-4 text-right text-sm text-gray-900">
                <%= number_with_delimiter(order.quantity) %>
              </td>
              <td class="whitespace-nowrap px-6 py-4 text-right text-sm text-gray-900">
                <%= order.price ? number_to_currency(order.price, unit: "KES ") : "Market" %>
              </td>
              <td class="whitespace-nowrap px-6 py-4 text-right">
                <div class="text-sm text-gray-900"><%= number_with_delimiter(order.filled_quantity || 0) %></div>
                <div class="text-xs text-gray-500"><%= order.fill_percentage %>%</div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <%
                  status_colors = {
                    "pending" => "bg-yellow-100 text-yellow-800",
                    "open" => "bg-blue-100 text-blue-800",
                    "partially_filled" => "bg-indigo-100 text-indigo-800",
                    "filled" => "bg-green-100 text-green-800",
                    "cancelled" => "bg-gray-100 text-gray-800",
                    "rejected" => "bg-red-100 text-red-800",
                    "expired" => "bg-orange-100 text-orange-800"
                  }
                %>
                <span class="inline-flex rounded-full px-2 py-1 text-xs font-semibold <%= status_colors[order.status] %>">
                  <%= order.status.titleize %>
                </span>
              </td>
              <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                <%= time_ago_in_words(order.created_at) %> ago
              </td>
              <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
                <%= link_to "View", order_path(order), class: "text-blue-600 hover:text-blue-900 mr-3" %>
                <% if order.can_cancel? %>
                  <%= button_to "Cancel", cancel_order_path(order), method: :post, class: "inline text-red-600 hover:text-red-900", form: { data: { turbo_confirm: "Are you sure you want to cancel this order?" } } %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="10" class="px-6 py-12 text-center">
              <div class="text-sm text-gray-500">
                <p class="mb-4">No orders found</p>
                <% if current_user.can_trade? %>
                  <%= link_to "Place your first order", new_order_path, class: "inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500" %>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center">
    <%= paginate @orders %>
  </div>
</div>
